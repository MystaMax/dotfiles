#!/usr/bin/env bash

####
#
# zd - Function to create and jump into a GitHub support ticket folder
#
# Usage: zd [customer] [ticket]
# Example: zd ibm 123456
#
####

function zd() {
    local customers_dir="$HOME/customers"
    local customer_arg="$1"
    local ticket_arg="$2"
    local customer ticket base_dir

    function prompt_for_inputs {
        if [ -z "$customer_arg" ]; then
            read -rp "Enter customer name: " customer_arg
        fi
        if [ -z "$ticket_arg" ]; then
            read -rp "Enter ticket number: " ticket_arg
        fi
    }

    function sanitize_inputs {
        customer=$(echo "$customer_arg" | awk '{$1=$1};1' | tr '[:upper:]' '[:lower:]')
        ticket=$(echo "$ticket_arg" | awk '{$1=$1};1')
    }

    function check_ticket_number {
        if [[ ! "$ticket" =~ ^[0-9]+$ ]]; then
            echo "âŒ Ticket number must be numeric." >&2
            return 1
        fi
    }

    function create_dirs {
        base_dir="$customers_dir/$customer/tickets/zd$ticket"
        mkdir -p "$base_dir"
    }

    function change_to_dir {
        cd "$base_dir" || {
            echo "Failed to cd into $base_dir" >&2
            return 1
        }
        echo "ğŸ“ Now in: $(pwd)"
    }

    prompt_for_inputs
    sanitize_inputs
    check_ticket_number || return 1
    create_dirs
    change_to_dir
}
